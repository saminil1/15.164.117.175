# 시스템 분석 보고서

**분석 일시**: 2025-10-07
**인스턴스**: i-003b47cc35e3dfee4

---

## 1. 시스템 환경

### 운영체제
- **OS**: Debian GNU/Linux 12 (Bookworm)
- **커널**: Linux 6.1.0-37-cloud-amd64
- **아키텍처**: x86_64
- **플랫폼**: AWS EC2

### 하드웨어 리소스
- **인스턴스 타입**: t3a.small
- **vCPU**: 2 cores
- **메모리**:
  - 총 메모리: 1.9GB
  - 사용 중: 1.5GB
  - 가용: 443MB
  - **⚠️ 경고**: 메모리 사용률 높음 (79%)
- **Swap**: 없음 ⚠️
- **디스크**:
  - 총 용량: 40GB
  - 사용: 19GB (51%)
  - 가용: 19GB

---

## 2. Bitnami Moodle 스택

### 설치 정보
- **설치 경로**: `/opt/bitnami`
- **Moodle 데이터**: `/bitnami/moodledata`
- **설정 파일**: `/opt/bitnami/moodle/config.php`

### 주요 컴포넌트 버전

| 컴포넌트 | 버전 | 상태 |
|---------|------|------|
| **Moodle** | 5.0.1 (Build: 20250609) | ✅ 최신 안정 버전 |
| **Apache** | 2.4.65 | ✅ 실행 중 |
| **PHP** | 8.2.29 | ✅ OPcache 활성화 |
| **MariaDB** | 11.8.2 | ✅ 실행 중 |
| **phpMyAdmin** | 5.2.2 | ✅ 설치됨 |

### Moodle 설정

#### 데이터베이스 설정
```
타입: MariaDB
호스트: 127.0.0.1:3306
데이터베이스명: bitnami_moodle
사용자: bn_moodle
문자셋: utf8mb4_unicode_520_nopad_ci
```

#### 웹 설정
- **프로토콜**: HTTP/HTTPS 자동 감지
- **기본 호스트**: 127.0.0.1:80
- **관리자 경로**: /admin
- **디렉토리 권한**: 02775

---

## 3. 서비스 상태

### 실행 중인 서비스

#### Apache
- **상태**: ✅ 실행 중
- **프로세스**: 5개 워커 활성
- **설정 파일**: `/opt/bitnami/apache/conf/httpd.conf`
- **포트**: 80 (HTTP), 443 (HTTPS)

#### MariaDB
- **상태**: ✅ 실행 중
- **프로세스 ID**: 952
- **CPU 사용**: 1.8%
- **메모리 사용**: 329MB (16.5%)
- **실행 시간**: 1586시간 53분
- **포트**: 3306 (로컬만 접근)
- **소켓**: `/opt/bitnami/mariadb/tmp/mysql.sock`

### 네트워크 포트

| 포트 | 서비스 | 접근 범위 |
|-----|--------|----------|
| 22 | SSH | 외부 |
| 80 | Apache HTTP | 외부 |
| 443 | Apache HTTPS | 외부 |
| 3306 | MariaDB | 로컬만 |
| 5000 | Python 서비스 | 외부 |

---

## 4. AWS 인프라

### 인스턴스 정보
- **인스턴스 ID**: i-003b47cc35e3dfee4
- **인스턴스 타입**: t3a.small
- **리전**: ap-northeast-2 (서울)
- **가용 영역**: ap-northeast-2 내

### 스토리지
- **루트 볼륨**: 40GB EBS (nvme0n1p1)
- **타입**: gp3 또는 gp2 추정
- **부팅 볼륨**: 124MB EBS (nvme0n1p15)

---

## 5. 비용 분석

### 월간 예상 비용 (서울 리전, 24시간 운영 기준)

#### 주요 비용 항목

| 항목 | 단가 | 월간 비용 |
|-----|------|----------|
| **EC2 (t3a.small)** | $0.0188/시간 | $13.72 |
| **EBS (40GB, gp3)** | $0.096/GB | $3.84 |
| **데이터 전송** (월 10GB) | $0.126/GB | $1.13 |
| **총계** | - | **$18.69** |

#### 비용 절감 옵션

1. **Savings Plans (1년 약정)**
   - 절감율: 약 40%
   - 월 비용: **$11.23**

2. **Savings Plans (3년 약정)**
   - 절감율: 약 60%
   - 월 비용: **$7.49**

3. **스팟 인스턴스**
   - 절감율: 최대 70%
   - 월 비용: **$5.62**
   - ⚠️ 중단 가능성 있음

---

## 6. 보안 검토

### 확인된 보안 사항

#### 양호
- ✅ MariaDB는 로컬(127.0.0.1)만 접근 가능
- ✅ SSH 포트 22 활성화 (원격 관리 가능)
- ✅ HTTPS(443) 활성화

#### 주의 필요
- ⚠️ **config.php 파일에 DB 비밀번호 평문 저장**
  - 파일 경로: `/opt/bitnami/moodle/config.php`
  - DB 비밀번호: f1f8ceff198c560307a453122015b939192d07196075754478bca45bb2dc4ea6
  - 권장: 파일 권한 확인 및 제한 (600 또는 640)

---

## 7. 성능 및 안정성 평가

### 현재 상태

| 지표 | 현재값 | 권장값 | 상태 |
|-----|--------|--------|------|
| **메모리 사용률** | 79% (1.5GB/1.9GB) | < 70% | ⚠️ 높음 |
| **디스크 사용률** | 51% (19GB/40GB) | < 80% | ✅ 양호 |
| **Swap 메모리** | 없음 | 최소 2GB | ⚠️ 미설정 |
| **Apache 워커** | 5개 | - | ✅ 정상 |
| **MariaDB 가동시간** | 1586시간 | - | ✅ 안정적 |

### 주요 이슈

1. **메모리 부족 위험**
   - 가용 메모리: 443MB
   - Moodle 동시 사용자 증가 시 성능 저하 가능
   - Swap 메모리 미설정으로 OOM 위험

2. **권장 조치사항**
   - **즉시**: Swap 파일 생성 (최소 2GB)
   - **단기**: 메모리 모니터링 강화
   - **중기**: t3a.medium (4GB RAM)으로 업그레이드 검토

---

## 8. 권장사항

### 즉시 조치
1. **Swap 메모리 추가**
   ```bash
   sudo fallocate -l 2G /swapfile
   sudo chmod 600 /swapfile
   sudo mkswap /swapfile
   sudo swapon /swapfile
   ```

2. **config.php 파일 권한 확인**
   ```bash
   chmod 640 /opt/bitnami/moodle/config.php
   ```

### 단기 개선
1. **메모리 모니터링**
   - CloudWatch 알람 설정 (메모리 사용률 80% 초과 시)
   - 주기적인 시스템 리소스 확인

2. **백업 전략 수립**
   - 데이터베이스 정기 백업
   - Moodle 데이터 디렉토리 백업
   - EBS 스냅샷 자동화

### 중장기 개선
1. **인스턴스 업그레이드**
   - t3a.medium (4GB RAM) 검토
   - 월 추가 비용: 약 $13

2. **비용 최적화**
   - Savings Plans 구매 (1년 약정 시 월 $7 절감)
   - 개발/테스트 환경 분리 시 스팟 인스턴스 활용

3. **고가용성 구성**
   - RDS for MariaDB 마이그레이션 검토
   - 로드 밸런서 및 Auto Scaling 검토

---

## 9. 요약

### 강점
- ✅ 최신 안정 버전의 Moodle 5.0.1 운영
- ✅ 최신 PHP 8.2, MariaDB 11.8 사용
- ✅ 서비스 안정성 양호 (1500+ 시간 무중단)
- ✅ 적절한 비용 ($18.69/월)

### 개선 필요
- ⚠️ 메모리 부족 위험 (79% 사용, Swap 없음)
- ⚠️ 보안 강화 필요 (config.php 권한)
- ⚠️ 백업 전략 필요

### 결론
현재 시스템은 **기본적으로 안정적**이나, **메모리 부족 문제**로 인한 성능 저하 위험이 있습니다. Swap 메모리 추가 등 즉시 조치와 함께, 사용자 증가 시 인스턴스 업그레이드를 권장합니다.

---

**보고서 작성**: Claude Code
**분석 기준**: 2025-10-07
